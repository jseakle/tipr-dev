{% extends "base.html" %}
{% block head %}
    {{ block.super }}
    <title>tipr</title>
{% endblock %}
{% block extra_js %}
 {{ block.super }}
<script>
    var load = true;
    function register() {
        load = true;
        console.log(document.getElementsByName('name')[0].value)
        $.post('register/', {name: document.getElementsByName('name')[0].value}, function(data) {})
        .fail(function(response) {console.log(response)});
    }
    function sit(seat) {
        $.post('../sit/', {seat: seat, type: 'rps', game: {{game.id}}}, function(data) {
            $('#sitstat').html('sat in ' + seat)
        }).fail(function(response) {
            $('#sitstat').html(response.responseJSON['error'])
        });

    }
    function submit(move) {
        $.post('../submit/', {move: '{"type": "selection", "selection": "'+move+'"}'}, function(data) {
            $('#movestat').html('submitted ' + move)
        }).fail(function(response) {
            $('#movestat').html(response.responseJSON['error'])
        });
    }
    var timer = new Timer({
        fps: .000002,
        run: function () {
            if($('#gameboard').is(':empty')) {
                load = true;
            }
           $.post('../update/', {load: load}, function (response) {
                if ('error' in response) {
                    $('#game').html(response['error'])
                } else {
                    if (response['gameboard'] != 'U') {
                        $('#gameboard').html( response['gameboard'])
                        $('#gameboard #board').html(JSON.stringify(JSON.parse($('#gameboard #board_json').text()), null, 2))
                    }
                     $('#timer').html( response['timer'])
                    console.log(response)
                }
            }).fail(function (response) {
                console.log(response)
            });
            load = false;
        }
    });

    timer.start();
</script>
{% endblock extra_js %}

{% block content %}
<button name="sit" onclick="sit(0)">sit0</button>
<button name="sit" onclick="sit(1)">sit1</button>
<div id="sitstat"></div>
<button name="pebble" onclick="submit('Pebble')">pebble</button>
<button name="napkin" onclick="submit('Napkin')">napkin</button>
<div id="movestat"></div>
<div id="timer"></div>
<div id="chat">{% for message in chat_log %}
    {{ message }} <br>
{% endfor %}</div>
<div id="gameboard"></div>
{% endblock content %}